/*
*  \file  main.c
*  \brief  main function to execute the program.
*  \author  Amin, Basti, Semir and Daniel 
*  \copyright  See the LICENSE file.
*/

#include <stdio.h>
#include "brick.h"
#include "ev3_tacho.h"
#include "draw.h"
#include "ev3.h"
#include "ev3_port.h"
#include "ev3_sensor.h"

// WIN32 /////////////////////////////////////////
#ifdef __WIN32__

#include <windows.h>

// UNIX //////////////////////////////////////////
#else

#include <unistd.h>
#define Sleep( msec ) usleep(( msec ) * 1000 )

//////////////////////////////////////////////////
#endif

int main( void )
{
	int x;
	int y;
 
	node* head = NULL;
	node* tmp = NULL;
	callback disp = display;
	
	printf( "Initializing the robot...\n" );
	//check if the 
	if ( !brick_init()) return ( 1 );
	if ( ev3_init() < 1 ) return ( 1 );
	if(init() && ev3_sensor_init()){
		printf( "The drawing process is starting...\n" );
		/*
		double sonic[277][2] = {
			{-5,-12} , {-6,-12.5} , {-7,-13} , {-8,-14} , {-7.5,-14.5} , {-6,-15} , {-5,-15} , {-5,-14} , {-5.5,-13} , {-6,-12.5},
			{-11.5,-15.5},
			{-5,-15} , {-3.5,-14.5} , {-3.5,-14} , {-4,-13} , {-5,-12} , {-4,-12} , {-3,-12.5} , {-2,-12.5} , {-1.5,-13} , {-1.5,-13.5}, {-2,-14} , {-3.5,-14.5},
			{-11.5,-15.5},
			{-4,-12} , {-4,-11.5} , {-3.5,-11.5} , {-3.5,-11} , {-3.5,-10.5} , {-3,-10.5} , {-3,-11} , {-2.5,-11.5} , {-2,-11.5} , {-1.5,-11}, {-1.5,-11.5} , {-2,-12} , {-1.5,-12.5} , {-2,-12.5},
			{-11.5,-15.5},
			{2.5,-14.5} , {4,-15} , {5,-15} , {6.5,-14.5} , {6,-13.5} , {5,-12.5} , {4.5,-13} , {4,-14} , {4,-15},
			{-11.5,-15.5},
			{5,-12.5} , {4,-12} , {3,-13} , {2.5,-14} , {2.5,-14.5} , {1,-14} , {.5,-13.5} , {.5,-13} , {1,-12.5} , {2,-12.5}, {3,-12} , {4,-12} , {5,-12.5},
			{-11.5,-15.5},
			{1,-12.5} , {.5,-12} , {1,-12} , {.5,-11.5} , {.5,-11} , {1,-11} , {1,-11.5} , {2,-11.5} , {2,-11} , {3,-11}, {2.5,-11.5} , {3,-12} , {2,-12.5} , {1,-12.5},
			{-11.5,-15.5},
			{1,-11} , {1,-10} , {.5,-9} , {-1,-9.5} , {-1.5,-11},
			{-11.5,-15.5},
			{2,-11} , {2.5,-10} , {2,-9.5} , {2,-9} , {2,-8} , {2,-7.5} , {2.5,-7.5} , {3,-7.5} , {3.5,-8} , {3,-8.5}, {3,-9.5} , {2.5,-9.5} , {2,-9.5},
			{-11.5,-15.5},
			{2.5,-7.5} , {2.5,-8} , {2.5,-8.5},
			{-11.5,-15.5},
			{3,-7.5} , {3.5,-7.5} , {4,-7} , {3.5,-6} , {2.5,-5} , {1.5,-4} , {2,-5} , {2.5,-6} , {2,-7} , {2,-7.5},
			{-11.5,-15.5},
			{2.5,-6} , {3,-6.5} , {2,-7},
			{-11.5,-15.5},
			{1.5,-4} , {-.5,-4} , {-1.5,-5} , {-2,-6} , {-2,-7} , {-1,-8} , {0,-8.5} , {1.5,-8} , {2,-7.5},
			{-11.5,-15.5},
			{-3,-10.5} , {-3,-10} , {-4,-9.5} , {-4.5,-9} , {-4.5,-8.5} , {-4,-8} , {-3,-8} , {-3,-7} , {-3.5,-7} , {-3,-6.5}, {-2.5,-7} , {-2.5,-7.5} , {-2,-8} , {-2,-9.5} , {-3,-10},
			{-11.5,-15.5},
			{-4,-8} , {-3.5,-8.5} , {-3.5,-9},
			{-11.5,-15.5},
			{-3.5,-8.5} , {-3,-8.5},
			{-11.5,-15.5},
			{-3,-6.5} , {-3,-6} , {-2.5,-5.5} , {-2,-4.5} , {-2.5,-4} , {-3,-4.5} , {-4,-5} , {-5,-6} , {-5.5,-7} , {-5,-7.5} , {-4,-8},
			{-11.5,-15.5},
			{-3.5,-7} , {-4,-6.5} , {-3,-6} , {-3,-6.5},
			{-11.5,-15.5},
			{-1.5,-3} , {-1,-3.5} , {-.5,-4} , {-1,-3.5} , {-2,-3.5} , {-3,-2.5} , {-3.5,-2} , {-4,-1} , {-3,0} , {-2,-.5}, {-1,-1} , {0,-1.5} , {1,-1} , {2,-.5} , {3,-.5} , {3.5,-1} , {4,-.5} , {4.5,-.5} , {4,-1.5} , {3.5,-1.5} , {3.5,-1},
			{-11.5,-15.5},
			{1.5,-4} , {2.5,-3} , {3,-3} , {4,-2.5} , {4.5,-2} , {4,-1.5},
			{-11.5,-15.5},
			{-1,-1.5} , {-1.5,-2} , {0,-2.5} , {1,-3} , {2,-3} , {1,-3.5} , {0,-3.5} , {-1,-3} , {-1.5,-2} , {-1.5,-2.5},
			{-11.5,-15.5},
			{-2,-.5} , {-2.5,0} , {-3,1} , {-3,3} , {-2.5,4} , {-1,5} , {.5,4.5} , {1.5,3.5} , {2.5,2.5} , {3.5,3}, {4.5,3.5} , {5,3} , {5.5,2} , {5,1} , {5,0} , {4.5,-.5},
			{-11.5,-15.5},
			{-2.5,-4} , {-2.5,-3.5} , {-3,-3} , {-4,-3} , {-6,-3.5} , {-8,-4} , {-7.5,-1.5} , {-6.5,0} , {-6,1} , {-8,1.5}, {-11,2} , {-9.5,4} , {-8,5} , {-5.5,5.5},
			{-11.5,-15.5},
			{-4.5,3.5} , {-5,4.5} , {-5.5,5.5} , {-5.5,6.5} , {-4.5,6.5} , {-4,6.5} , {-3,6} , {-2,5.5},
			{-11.5,-15.5},
			{-4,4} , {-4.5,5} , {-5,6} , {-4,6} , {-2.5,5.5} , {-3,4.5} , {-4,4},
			{-11.5,-15.5},
			{5,3} , {4.5,4} , {5.5,5} , {5.5,6} , {4,6.5} , {3,6} , {3.5,5.5} , {4,5} , {4.5,4} , {5,5.5} , {4,5.5} , {3.5,5.5},
			{-11.5,-15.5},
			{3,6} , {1.5,6.5} , {0,9} , {-3,11} , {-6.5,11.5} , {-5,9} , {-4.5,8} , {-4.5,6.5}
		};
		
		//counter the problem with .5 values
		int k;
		int w;		
		for ( k = 0; k < 277; k++ ) {
			for ( w = 0; w < 2; w++ ) {
				sonic[k][w] = sonic[k][w] * 2;
			}
		}
		//since the minimum X is -22 and the minimum Y us -30 the values are added to all points respectivly in order to avoid negative values
		for ( k = 0; k < 277; k++ ) {
			sonic[k][0] = sonic[k][0] + 22;
			sonic[k][1] = sonic[k][1] + 30;
		}
		int i;
		//add all the values to the list
		head = prepend(head,sonic[0][0],sonic[0][1]);
		for ( i = 1; i < 277; i++ ) {
			head = append(head,sonic[i][0],sonic[i][1]);
		}
		*/
		
		
		double homer[189][2] = {
			{1,-6.5},{3,-7},{5,-7},{6.5,-7},{7.5,-6.5},{9,-6},{9.5,-5},{9.5,-4},{9.5,-3},{9,-2},{8.5,-1},{8,-.5},{7.5,-.5},{6,-.5},{3,-1},{1,-2},{-.5,-3},{-1.5,-4},{-2,-6},{-2,-7},{-1,-9},{0,-10},{2,-10.5},{4,-10.5},{5,-10},{5.5,-9.5},{6,-8.5},{7,-8},{7.5,-7.5},{7.5,-6.5},
						{-15.5,-17.5},
						{7.5,-.5},{8,0},{8.5,.5},{8.5,1.5},{8,2},{6.5,2.5},{5,2},{3.5,2},{3.5,4},{3,5.5},{3.5,6},{4,6.5},{5,7},{6,7},{7,6.5},{8,5.5},{8.5,5},{8.5,3},{8,2},
						{-15.5,-17.5},
						{3.5,2},{2.5,1},{2,.5},{1,0},{0,0},{-2,.5},{-3,2},{-3.5,4},{-2.5,5.5},{-1.5,6},{0,6.5},{2,6},{3,5.5},
						{-15.5,-17.5},
						{-7.5,-2},{-7.5,0},{-7.5,2},{-6.5,0},{-5.5,-1.5},{-5.5,0},{-5.5,2.5},{-4,-.5},
						{-15.5,-17.5},
						{-5.5,-1.5},{-6,0},{-6.5,2},{-7.5,4},{-8,6},{-8.5,8},{-8,10},{-7,11.5},{-6,12.5},{-5,13.5},{-4,14},{-3,14.5},{-1.5,14.5},{-.5,14.5},{1,14.5},{2.5,14},{3.5,13},{4.5,12},{5.5,10},{6,9},{6.5,8},{7.5,7},{8,6},{8,5.5},
						{-15.5,-17.5},
						{-7.5,9},{-8,10},{-8.5,12},{-7.5,14},{-6,15},{-4.5,14.5},{-4,14},
						{-15.5,-17.5},
						{-6.5,11.5},{-6.5,13},{-6.5,14},{-5.5,15.5},{-4,16},{-2,16},{-1,15.5},{-.5,14.5},
						{-15.5,-17.5},
						{-4,-2.5},{-4.5,-1.5},{-5.5,-1.5},{-6.5,-2},{-6.5,-3},{-6.5,-4},{-6,-4.5},{-5.5,-4.5},{-4.5,-4.5},{-4,-4},
						{-15.5,-17.5},
						{-5.5,-4.5},{-5.5,-6},{-5.5,-8},{-6,-9},{-7,-10},{-7.5,-12},{-7.5,-13},{-7,-14},{-5,-15},{-2,-16},{0,-16.5},{.5,-13},{1.5,-11.5},{-1,-11.5},{-3,-11},{-5,-10},{-6,-9},
						{-15.5,-17.5},
						{1.5,-11.5},{3,-14},{4.5,-16},{5.5,-14},{6.5,-11},{5,-10},{5.5,-14},
						{-15.5,-17.5},
						{6.5,-11},{7,-13},{7.5,-14.5},{8,-16},{6.5,-14},{5.5,-14},
						{-15.5,-17.5},
						{7.5,-14.5},{11,-15},{13,-17},{-5,-17},
						{-15.5,-17.5},
						{-7.5,-13},{-8,-14},{-8.5,-14.5},
						{-15.5,-17.5},
						{-5,-17},{-13,-17},{-11,-15},{-10,-14.5},{-8.5,-14.5},{-7.5,-14.5},{-6,-16},{-5,-17},
						{-15.5,-17.5},
						{-5.5,-2},{-6,-3},{-5.5,-3.5},
						{-15.5,-17.5},
						{-6,-3},{-5.5,-3},
						{-15.5,-17.5},
						{.5,-7},{1,-6.5},{1.5,-6},
						{-15.5,-17.5},
						//{-0.5,2.5},{0,3},{0.5,2.5},{0,2},{-0.5,2.5},
						//{-15.5,-17.5},
						//{5.5,3.5},{6,4},{6.5,3.5},{6,3},{5.5,3.5},
						//{-15.5,-17.5}
		};
		
		//counter the problem with .5 values
		int k;
		int w;		
		for ( k = 0; k < 189; k++ ) {
			for ( w = 0; w < 2; w++ ) {
				homer[k][w] = homer[k][w] * 2;
			}
		}
		//since the minimum X is -26 and the minimum Y us -34 the values are added to all points respectivly in order to avoid negative values
		for ( k = 0; k < 189; k++ ) {
			homer[k][0] = homer[k][0] + 32;
			homer[k][1] = homer[k][1] + 34;
		}
		int i;
		//add all the values to the list
		head = prepend(head,homer[0][0],homer[0][1]);
		for ( i = 1; i < 189; i++ ) {
			head = append(head,homer[i][0],homer[i][1]);
		}
		
		
		/*
		//needed points for bugs bunny
		int bugsbunny[174][2] = {
		{-8, -8}, {-7, -7}, {-6, -5}, {-6, -4}, {-5, -2}, {-5, -1}, {-7, 1}, {-9, 4}, {-10, 6}, {-11, 9}, {-12, 13}, {-12, 16}, {-11, 19}, {-10, 19}, {-9, 16}, {-5, 9}, {-4, 6}, {-3, 4}, {-2, 1}, {-1, 0}, {0, 1}, {1, 0}, {2, 1}, {3, 4}, {4, 6}, {5, 9}, {9, 16}, {10, 19}, {11, 19}, {12, 16}, {12, 13}, {11, 9}, {10, 6}, {9, 4}, {7, 1}, {5, -1}, {5, -2}, {6, -4}, {6, -5}, {7, -7}, {8, -8}, {10, -8}, {12, -9}, {13, -11}, {13, -12}, {12, -14}, {11, -15}, {9, -16}, {7,-18}, {5,-19}, {4,-20}, {1,-21}, {-1,-21}, {-4,-20}, {-5,-19}, {-7,-18}, {-9,-16}, {-11,-15}, {-12,-14}, {-13,-12}, {-13,-11}, {-12,-9}, {-10,-8}, {-7,-8}, {-4,-9}, {-2,-10}, {0,-12}, {2,-10}, {4,-9}, {7,-8}, {8,-8},


		{-22, -22},
			

		{-4, -9}, {-5, -7}, {-5,-4}, {-4,-2}, {-3,-2}, {-2,-4}, {-1,-7}, {-1,-9}, {-2,-10}, {-2,-7}, {-1,-9}, {-2, -10}, {-2,-7}, {-3,-6}, {-4,-7}, {-4,-9},


		{-22, -22},


		{4,-9}, {5,-7}, {5,-4}, {4,-2}, {3,-2}, {2,-4}, {1,-7}, {1,-9}, {2,-10}, {2,-7}, {3,-6}, {4,-7}, {4,-9},


		{-22, -22},


		{-4,1}, {-4,2}, {-7,9}, {-8,11}, {-9,14}, {-10,16}, {-11,17}, {-11,12}, {-10,9}, {-9,7}, {-7,4}, {-4,1},


		{-22, -22},

		{4,1}, {4,2}, {7,9}, {8,11}, {9,14}, {10,16}, {11,17}, {11,12}, {10,9}, {9,7}, {7,4}, {4,1},


		{-22, -22},


		{-5,-1}, {-4,0}, {-3,0}, {-2,-1},
			
			
		{-22, -22},
			

		{-3,-12}, {-2,-16}, {0,-17}, {2,-16}, {3,-12}, {2,-11},
			
			
		{-22, -22},
			

		{0,-13}, {0,-17},
			
			
		{-22, -22},
			

		{5,-19}, {6,-17},
			
			
		{-22, -22},
			

		{-5,-19}, {-6,-17},
			
			
		{-22, -22},
			

		{3,-11}, {11,-8}, {13,-8},
			
			
		{-22, -22},
			

		{4,-11}, {10,-10}, {14,-10},
			
			
		{-22, -22},
			

		{5,-11}, {8,-11}, {14,-12},
			
			
		{-22, -22},
			

		{-3,-11}, {-11,-8}, {-13,-8},
			
			
		{-22, -22},
			

		{-4,-11}, {-10,-10}, {-14,-10},
			
			
		{-22, -22},
			

		{-5,-11}, {-8,-11}, {-14,-12},
			
			
		{-22, -22},
			
		};
		
		//add 21 to all points to avoid minus values
		int i;
		int j;		
		for ( i = 0; i < 174; i++ ) {
			for ( j = 0; j < 2; j++ ) {
				bugsbunny[i][j] = bugsbunny[i][j] + 21;
			}
		}
		//add all the values to the list
		head = prepend(head,bugsbunny[0][0],bugsbunny[0][1]);
		for ( i = 1; i < 174; i++ ) {
			head = append(head,bugsbunny[i][0],bugsbunny[i][1]);
		}
		
		*/
		
		/*
		//needed points for batman
		int batman[70][2] = {
			{0,-12}, {4,-6}, {5,-5}, {6,-5}, {7,-6}, {8,-8}, {9,-6}, {10,-5}, {11,-5}, {12,-6}, {13,-8}, {13,-9}, {12,-11}, {11,-12}, {14,-11}, {17,-9}, {19,-7}, {20,-5}, {21,-2}, {21,1}, {20,4}, {19,6}, {17,8}, {14,10}, {11,11}, {12,10}, {13,8}, {13,7}, {12,5}, {11,4}, {9,3}, {6,3}, {3,4}, {3,12}, {1,9}, {-1,9}, {-3,12}, {-3,4}, {-6,3}, {-9,3}, {-11,4}, {-12,5}, {-13,7}, {-13,8}, {-12,10}, {-11,11}, {-14,10}, {-17,8}, {-19,6}, {-20,4}, {-21,1}, {-21,-2}, {-20,-5}, {-19,-7}, {-17,-9}, {-14,-11}, {-11,-12}, {-12,-11}, {-13,-9}, {-13,-8}, {-12,-6}, {-11,-5}, {-10,-5}, {-9,-6}, {-8,-8}, {-7,-6}, {-6,-5}, {-5,-5}, {-4,-6}, {0,-12}
		};
		
		//add 21 to all points to avoid minus values
		int i;
		int j;		
		for ( i = 0; i < 70; i++ ) {
			for ( j = 0; j < 2; j++ ) {
				batman[i][j] = batman[i][j] + 21;
			}
		}
		//add all the values to the list
		head = prepend(head,batman[0][0],batman[0][1]);
		for ( i = 1; i < 70; i++ ) {
			head = append(head,batman[i][0],batman[i][1]);
		}
		*/
		
		
		//draw the picture
		draw(head);
		printf( "The drawing process terminated.\n" );
	}
	//uninitialize the robot
	brick_uninit();
	return ( 0 );
}
